# Remote Settings Protocol
The purpose of this protocol is to allow one extension to control a subset of another extensions
settings. The master will be able to get and set specific settings, get all settings and listen
for changes of settings of the slave.

**This is document is a draft**

## Reference implementation

The folders `master` and `slave` contain a reference implementation of the protocol. The extensions
are meant to be loaded as unpacked chrome extensions

## Protocol

The protocol uses `chrome.runtime.sendMessage` and `chrome.runtime.onMessageExternal` to pass
messages between master and slave.

### Messages from master to slave

#### set
Message to slave
```javascript
{
  command: 'settings:set',
  key: 'volume', // Name of the specific setting
  value: '' // Value to be set
}
```
Response from slave when setting was applied
```javascript
{}
```
or when an error occured
```javascript
{
  error: 'Remote is not allowed to control setting volume'
}
```

#### get
Message to slave
```javascript
{
  command: 'settings:get',
  key: 'volume', // Name of setting to read
}
```
Response from slave
```javascript
{
  value: 11
}
```

#### getAll
Message to slave
```javascript
{
  command: 'settings:getAll'
}
```
Response from slave when setting was applied
```javascript
{
  value: {
    volume: 11,
    input: 'tape',
    ...
  }
}
```

### Messages slave to master

#### onChange

Message to master
```javascript
{
  command: 'settings:onChange',
  key: 'volume',
  value: 8,
  oldValue: 11
}
```
This message should be send to the master even if the master initiated the change.

## Note

For simplicity both manifest files contain a key entry, this ensures that the unpacked extensions
will have the consistent ids. In a production environment the ids will of course be generated by
the chrome store and the key entries are not required.
